!function(e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):window.Translate=e()}(function(){var e=(window&&window.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},function(e,t){for(var n in t)t.hasOwnProperty(n)&&e&&!e.hasOwnProperty(n)&&(e[n]=t[n])}),t=function(e,t){if(t.length)for(var n=0;n<t.length;e.push(t[n]),n++);};Array.prototype.filter||(Array.prototype.filter=function(e){var t=this.length;if("function"!=typeof e)throw new TypeError;for(var n=new Array,r=arguments[1],a=0;a<t;a++)if(a in this){var o=this[a];e.call(r,o,a,this)&&n.push(o)}return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=this.length,n=0;n<t;e(this[n],n),n++);});var n=Array.prototype.slice,r=Array.prototype.filter;Array.prototype.clean=function(e){e=e?e:"";for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this},String.prototype.cleanSpace=function(){return this.replace(/\s/g,"")},window.document.querySelectorAll||(window.document.querySelectorAll=function(e){var t,n=window.document.createElement("style"),r=[];for(window.document.documentElement.firstChild.appendChild(n),window.document._qsa=[],n.styleSheet.cssText=e+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),n.parentNode.removeChild(n);window.document._qsa.length;)t=window.document._qsa.shift(),t.style.removeAttribute("x-qsa"),r.push(t);return window.document._qsa=null,r}),window.document.querySelector||(window.document.querySelector=function(e){var t=window.document.querySelectorAll(e);return t.length?t[0]:null});var a={NSWarehouse:{},NSNameCamp:[],elementMatchTagHead:"TransMatch_",elementRegisteredTagHead:"TransRegistered_",translateTextTag:{begin:"@{",end:"}"},translateWrapper:"multi-translation",translateWrapperHandleFlag:"wrapperHandled",attributeNamespaceHead:"i18n-"},o=function(l){var i=this;if(!l||l&&!l.defaultLanguage||l&&!l.namespace)throw Error("You must config 'Translate' at least two of Attrs {defaultLanguage: String,namespace: String} in your project.");if(!i instanceof o)return new o(l);i.Name="Translate",i.Version="1.1.0",i.currentLanguageData=null,i.currentLanguageTag=l.defaultLanguage,i.namespace=l.namespace,i.defaultNS="default";var s={allLanguagesData:{},allLanguagesMarks:[],nodeRegisteredList:[]},c={transitionsBeenSet:!1};if(a.NSNameCamp.join(",").indexOf(i.namespace)!=-1)throw Error("The namespace ["+i.namespace+"] has already been registered,can not be used again!");t(a.NSNameCamp,[i.namespace]);var u={commonMethod:{},textController:{},nodesController:{},pluginInterface:{}};return e(u.commonMethod,{getAllTargetNodes:function(e,t){return t=t?t:window.document,n.call(t.querySelectorAll(e))},translateMachine:function(e){var t=null===i.currentLanguageData?u.commonMethod.setCurrentLangData():i.currentLanguageData,n=e.split(".");if(n.clean(""),n.length<1)return"{{Bad Translation!}}";for(var r=0;r<n.length;r++){if(!t[n[r]]){console.log(t),console.log("未在{"+i.namespace+"}翻译域中匹配到["+e+"] 的对应字段，请检查。"),t="{{Bad Translation!}}";break}t=t[n[r]]}return t},switchAttrOrText:function(e,t){var n=e.split("|"),r=u.commonMethod.translateMachine(n[0]);if(n.length>1){var a=n,o=0;for(a.shift();o<a.length;o++)"html"===a[o]?t.innerHTML=r:t.setAttribute(a[o],r)}else t.innerHTML=r},matchTranslateStr:function(e,t){var n=[];if("string"==typeof e){if(e=e.cleanSpace(),!e)return;var r=e.match(/\{.*?\}/g);n=e.replace(/\{.*?\}/g,"").split(",").clean(),r&&r.forEach(function(e){n.push(e.match(/\{(.+\S?)\}/)[1])})}else{if(!(e instanceof Array))return[];n=e}return t[a.elementMatchTagHead+i.namespace]=n,t.removeAttribute(i.namespace),n},getTargetTranslation:function(e,t){e instanceof Array&&0!=e.length?e.forEach(function(e){u.commonMethod.switchAttrOrText(e,t)}):"string"==typeof matchs&&u.commonMethod.switchAttrOrText(e,t)},setCurrentLangData:function(){return i.currentLanguageData=s.allLanguagesData[i.currentLanguageTag]},setCurrentLang:function(e,t){i.currentLanguageTag=i.currentLanguageTag=e,"function"==typeof t&&t()}}),e(u.textController,{returnTextTagMatchRegExp:function(e,t){return new RegExp(a.translateTextTag.begin+e+a.translateTextTag.end,t)},stringNodeTranslator:function(e){var t=u.nodesController.getNodeFragment(e);return t},createBLabel:function(e,t){var n=window.document.createElement("b");return n.setAttribute(a.attributeNamespaceHead+e,t),a.NSNameCamp.join(",").indexOf(e)==-1&&console.log("Namespace ["+e+"] has not been registered yet!"),n},matchTextTransSource:function(e){return e.replace(u.textController.returnTextTagMatchRegExp(".*?","g"),function(e){var t,n=e.match(u.textController.returnTextTagMatchRegExp("(.+S?)"));if(n=n[1].cleanSpace(),n.indexOf("|")!=-1){var r=n.split("|");t=u.nodesController.getNodeInnerHtmlString(u.textController.createBLabel(r[1],r[0]))}else t=u.nodesController.getNodeInnerHtmlString(u.textController.createBLabel(i.defaultNS,n));return t})},innerTextCompiler:function(e,t){if(e&&""!=e){var n=u.textController.matchTextTransSource(e);return t&&"function"==typeof t&&t(n),n}var o=window.document.getElementsByTagName(a.translateWrapper);if(console.log(o),o=r.call(o,function(e){return!e[a.translateWrapperHandleFlag]}),!(o.length<1))return o.forEach(function(e,t){var n=u.textController.matchTextTransSource(e.innerHTML);e.innerHTML="",e[a.translateWrapperHandleFlag]=!0,e.appendChild(u.textController.stringNodeTranslator(n))}),t&&t(),null}}),e(u.nodesController,{getNodeFragment:function(e){var t,n,r;return r=window.document.getElementById("frame_range"),null===r&&(r=window.document.createElement("iframe"),r.setAttribute("id","frame_range"),r.setAttribute("style","display: none;"),window.document.body.appendChild(r)),n=window.document.createRange(),n.selectNode(r),t=n.createContextualFragment(e)},getNodeInnerHtmlString:function(e){var t=window.document.createElement("div");return t.appendChild(e),t.innerHTML},getElementNSMatches:function(e){var t="";return t=e.getAttribute(a.attributeNamespaceHead+i.namespace),console.log("GET MATCHES"),console.log(t),null!==t&&(console.log("删除属性"),e.removeAttribute(a.attributeNamespaceHead+i.namespace)),t},selectTargetToRegTranslator:function(e){var n=[];a.NSNameCamp.forEach(function(r){t(n,u.commonMethod.getAllTargetNodes("["+a.attributeNamespaceHead+r+"]",e))}),n=n.filter(function(e){for(var t=0,n=!1;t<a.NSNameCamp.length;t++){var r=a.NSNameCamp[t];if(!e[a.elementRegisteredTagHead+r])if(r===i.namespace){var o=u.nodesController.getElementNSMatches(e);i.currentLanguageData&&null!==o&&(o=u.commonMethod.matchTranslateStr(o,e),u.commonMethod.getTargetTranslation(o,e)),n=!0}else{var l=a.NSWarehouse[r];l.registerElement(e)}}return n}),0!=n.length&&u.nodesController.registerNodeList(n)},registerNodeList:function(e){e.forEach(function(e,t){e[a.elementRegisteredTagHead+i.namespace]=!0}),console.log(e),t(s.nodeRegisteredList,e)},isolateTranslator:function(e,n){var r=[];if(i.currentLanguageData){var a=u.nodesController.getElementNSMatches(e);console.log(e),console.log(i.namespace),a&&t(r,u.commonMethod.matchTranslateStr(a,e)),n&&t(r,u.commonMethod.matchTranslateStr(n,e)),u.commonMethod.getTargetTranslation(r,e)}return u.nodesController.registerNodeList([e]),e}}),e(u.pluginInterface,{detectLanguageRegistered:function(e){return s.allLanguagesMarks.join(",").indexOf(e)!=-1},stringSelectTargetToRegTranslator:function(e){var t=u.textController.innerTextCompiler(e),n=u.nodesController.getNodeFragment(t);return u.nodesController.selectTargetToRegTranslator(n),n},registerLanguages:function(t,n){if(1==t.length)if("object"==typeof t[0])e(s.allLanguagesData,t[0]);else try{t=JSON.parse(t[0]),e(s.allLanguagesData,t)}catch(e){console.log(e)}else if(2==t.length){if("string"!=typeof t[0])throw Error("The [translation] parameters should be ([string],[object | JSON string ]) or ([object | JSON string]) !");var r={};if("object"==typeof t[1])r[t[0]]=t[1];else try{r[t[0]]=JSON.parse(t[1])}catch(e){console.log(e)}e(s.allLanguagesData,r)}s.allLanguagesMarks=[];for(var a in s.allLanguagesData)s.allLanguagesMarks.push(a);n&&n()},switchTranslator:function(e){e=e.trim(),u.commonMethod.setCurrentLang(e,u.commonMethod.setCurrentLangData),s.nodeRegisteredList.forEach(function(e,t){var n=s.nodeRegisteredList[t][a.elementMatchTagHead+i.namespace];console.log(n),u.commonMethod.getTargetTranslation(n,e),console.log(e)})},initTranslator:function(){u.commonMethod.setCurrentLangData(),u.nodesController.selectTargetToRegTranslator()}}),u.textController.innerTextCompiler(),i.translations=function(){if(c.transitionsBeenSet)console.log("The [transitions] method can not be used twice!");else{if(arguments.length<1)return i;var e=arguments;u.pluginInterface.registerLanguages(e,u.pluginInterface.initTranslator),c.transitionsBeenSet=!0}return i},i.switch=function(e){if("string"!=typeof e||e&&""==e.trim())throw Error("To Translate 'use' function parameter must be a string！");return u.pluginInterface.detectLanguageRegistered(e)?void(e!==i.currentLanguageTag&&u.pluginInterface.switchTranslator(e)):(alert("你要切换的语言{"+e+"}未被注册，请注册后使用！"),void console.log("The language tag ["+e+"] has not been registered!"))},i.nodeString=function(e){return u.pluginInterface.stringSelectTargetToRegTranslator(e)},i.registerElement=function(e,t){return u.nodesController.isolateTranslator(e,t)},i},l=function(t,n){var r={};r[n.namespace]=t,e(a.NSWarehouse,r)},i=function(e){return a.NSWarehouse[e]?a.NSWarehouse[e]:console.log("Can not find a namespace like ["+e+"]!"),null},s={createNamespace:function(e){var t=new o(e);return l(t,e),t},use:function(e){return i(e)}};return s});