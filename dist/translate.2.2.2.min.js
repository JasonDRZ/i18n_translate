!function(e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):window.Translate=e()}(function(){var e=(window&&window.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},function(e,t){for(var n in t)t.hasOwnProperty(n)&&e&&!e.hasOwnProperty(n)&&(e[n]=t[n])}),t=function(e,t){if(t.length)for(var n=0;n<t.length;e.push(t[n]),n++);};Array.prototype.filter||(Array.prototype.filter=function(e){var t=this.length;if("function"!=typeof e)throw new TypeError;for(var n=new Array,r=arguments[1],a=0;a<t;a++)if(a in this){var o=this[a];e.call(r,o,a,this)&&n.push(o)}return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=this.length,n=0;n<t;e(this[n],n),n++);});var n=Array.prototype.slice,r=Array.prototype.filter;Array.prototype.clean=function(e){e=e?e:"";for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this},String.prototype.cleanSpace=function(){return this.replace(/\s/g,"")},window.document.querySelectorAll||(window.document.querySelectorAll=function(e){var t,n=window.document.createElement("style"),r=[];for(window.document.documentElement.firstChild.appendChild(n),window.document._qsa=[],n.styleSheet.cssText=e+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),n.parentNode.removeChild(n);window.document._qsa.length;)t=window.document._qsa.shift(),t.style.removeAttribute("x-qsa"),r.push(t);return window.document._qsa=null,r}),window.document.querySelector||(window.document.querySelector=function(e){var t=window.document.querySelectorAll(e);return t.length?t[0]:null});var a={rootScope:window,scopeCamp:{},scopesContainer:{},namespaceCamp:[],namespaceAttributeTag:"translatenamespace",elementMatchTagHead:"TransMatch_",elementRegisteredTagHead:"TransRegistered_",translateTextTag:{begin:"@{",end:"}"},translateWrapper:"multi-translation",translateWrapperHandleFlag:"wrapperHandled",attributeNamespaceHead:"i18n-"},o=function(l){var s=this;if(!l||l&&!l.default||l&&!l.namespace)throw Error("You must config 'Translate' at least two of Attrs {default: String,namespace: String} in your project.");if(!s instanceof o)return new o(l);s.Name="Translate",s.Version="1.1.0",s.currentLanguageData=null,s.currentLanguageTag=l.default,s.namespace=l.namespace,s.defaultNS="default";var i={allLanguagesData:{},allLanguagesMarks:[],nodeRegisteredList:[]};if(a.namespaceCamp.join(",").indexOf(s.namespace)!=-1)throw Error("The namespace ["+s.namespace+"] has already been registered by {"+a.scopeCamp[s.namespace].scopePath+"},can not be used again!");t(a.namespaceCamp,[s.namespace]);var c={commonMethod:{},textController:{},nodesController:{},pluginInterface:{}};return e(c.commonMethod,{getAllTargetNodes:function(e,t){return t=t?t:window.document,n.call(t.querySelectorAll(e))},translateMachine:function(e){var t=null===s.currentLanguageData?c.commonMethod.setCurrentLangData():s.currentLanguageData,n=e.split(".");if(n.clean(""),n.length<1)return"{{Bad Translation!}}";for(var r=0;r<n.length;r++){if(!t[n[r]]){console.log(t),console.log("未在{"+s.namespace+"}翻译域中匹配到["+e+"] 的对应字段，请检查。"),t="{{Bad Translation!}}";break}t=t[n[r]]}return t},switchAttrOrText:function(e,t){var n=e.split("|"),r=c.commonMethod.translateMachine(n[0]);if(n.length>1){var a=n,o=0;for(a.shift();o<a.length;o++)t.setAttribute(a[o],r)}else t.innerHTML=r},matchTranslateStr:function(e,t){var n=[];if("string"==typeof e){if(e=e.cleanSpace(),!e)return;var r=e.match(/\{.*?\}/g);n=e.replace(/\{.*?\}/g,"").split(",").clean(),r&&r.forEach(function(e){n.push(e.match(/\{(.+\S?)\}/)[1])})}else{if(!(e instanceof Array))return[];n=e}return t[a.elementMatchTagHead+s.namespace]=n,t.removeAttribute(s.namespace),n},getTargetTranslation:function(e,t){e instanceof Array&&0!=e.length?e.forEach(function(e){c.commonMethod.switchAttrOrText(e,t)}):"string"==typeof matchs&&c.commonMethod.switchAttrOrText(e,t)},setCurrentLangData:function(){return s.currentLanguageData=i.allLanguagesData[s.currentLanguageTag]},setCurrentLang:function(e,t){s.currentLanguageTag=s.currentLanguageTag=e,"function"==typeof t&&t()}}),e(c.textController,{returnTextTagMatchRegExp:function(e,t){return new RegExp(a.translateTextTag.begin+e+a.translateTextTag.end,t)},stringNodeTranslator:function(e){var t=c.nodesController.getNodeFragment(e);return t},createBLabel:function(e,t){var n=window.document.createElement("b");return n.setAttribute(a.attributeNamespaceHead+e,t),n[a.namespaceAttributeTag]=e,n[a.attributeNamespaceHead+e]=t,a.namespaceCamp.join(",").indexOf(e)==-1&&console.log("Namespace ["+e+"] has not been registered yet!"),n},matchTextTransSource:function(e){return e.replace(c.textController.returnTextTagMatchRegExp(".*?","g"),function(e){var t,n=e.match(c.textController.returnTextTagMatchRegExp("(.+S?)"));if(n=n[1].cleanSpace(),n.indexOf("|")!=-1){var r=n.split("|");t=c.nodesController.getNodeInnerHtmlString(c.textController.createBLabel(r[1],r[0]))}else t=c.nodesController.getNodeInnerHtmlString(c.textController.createBLabel(s.defaultNS,n));return t})},innerTextCompiler:function(e,t){if(e&&""!=e){var n=c.textController.matchTextTransSource(e);return t&&"function"==typeof t&&t(n),n}var o=window.document.getElementsByTagName(a.translateWrapper);if(console.log(o),o=r.call(o,function(e){return!e[a.translateWrapperHandleFlag]}),!(o.length<1))return o.forEach(function(e,t){var n=c.textController.matchTextTransSource(e.innerHTML);e.innerHTML="",e[a.translateWrapperHandleFlag]=!0,e.appendChild(c.textController.stringNodeTranslator(n))}),t&&t(),null}}),e(c.nodesController,{getNodeFragment:function(e){var t,n,r;return r=window.document.getElementById("frame_range"),null===r&&(r=window.document.createElement("iframe"),r.setAttribute("id","frame_range"),r.setAttribute("style","display: none;"),window.document.body.appendChild(r)),n=window.document.createRange(),n.selectNode(r),t=n.createContextualFragment(e)},getNodeInnerHtmlString:function(e){var t=window.document.createElement("div");return t.appendChild(e),t.innerHTML},getElementNSMatches:function(e){var t="";return e[a.attributeNamespaceHead+s.namespace]?t=e[a.attributeNamespaceHead+s.namespace]:(t=e.getAttribute(a.attributeNamespaceHead+s.namespace),e[a.attributeNamespaceHead+s.namespace]=t),t},selectTargetToRegTranslator:function(e){var n=[];a.namespaceCamp.forEach(function(r){t(n,c.commonMethod.getAllTargetNodes("["+a.attributeNamespaceHead+r+"]",e))}),n=n.filter(function(e){return!e[a.elementRegisteredTagHead+s.namespace]}),0!=n.length&&(console.log(n),n.forEach(function(e,t){var n=c.nodesController.getElementNSMatches(e);console.log(n),s.currentLanguageData&&n&&(n=c.commonMethod.matchTranslateStr(n,e),c.commonMethod.getTargetTranslation(n,e))}),n=n.filter(function(e){var t=[],n=!0;return a.namespaceCamp.forEach(function(e){e!=s.namespace&&t.push(e)}),t.forEach(function(t){var r=c.nodesController.getElementNSMatches(e);if(r){var o=a.scopesContainer[t];o.registerElement(e),n=!1}}),n}),c.nodesController.registerNodeList(n))},registerNodeList:function(e){e.forEach(function(e,t){e[a.elementRegisteredTagHead+s.namespace]=!0}),console.log(e),t(i.nodeRegisteredList,e)},isolateTranslator:function(e,n){var r=[];if(s.currentLanguageData){var a=c.nodesController.getElementNSMatches(e);a&&t(r,c.commonMethod.matchTranslateStr(a,e)),n&&t(r,c.commonMethod.matchTranslateStr(n,e)),c.commonMethod.getTargetTranslation(r,e)}return c.nodesController.registerNodeList([e]),e}}),e(c.pluginInterface,{detectLanguageRegistered:function(e){return i.allLanguagesMarks.join(",").indexOf(e)!=-1},stringSelectTargetToRegTranslator:function(e){var t=c.textController.innerTextCompiler(e),n=c.nodesController.getNodeFragment(t);return c.nodesController.selectTargetToRegTranslator(n),n},registerLanguages:function(t,n){if(1==t.length)if("object"==typeof t[0])e(i.allLanguagesData,t[0]);else try{t=JSON.parse(t[0]),e(i.allLanguagesData,t)}catch(e){console.log(e)}else if(2==t.length){if("string"!=typeof t[0])throw Error("The [translation] parameters should be ([string],[object | JSON string ]) or ([object | JSON string]) !");var r={};if("object"==typeof t[1])r[t[0]]=t[1];else try{r[t[0]]=JSON.parse(t[1])}catch(e){console.log(e)}e(i.allLanguagesData,r)}i.allLanguagesMarks=[];for(var a in i.allLanguagesData)i.allLanguagesMarks.push(a);n&&n()},switchTranslator:function(e){e=e.trim(),c.commonMethod.setCurrentLang(e,c.commonMethod.setCurrentLangData),i.nodeRegisteredList.forEach(function(e,t){var n=i.nodeRegisteredList[t][a.elementMatchTagHead+s.namespace];console.log(n),c.commonMethod.getTargetTranslation(n,e),console.log(e)})},initTranslator:function(){c.commonMethod.setCurrentLangData(),c.nodesController.selectTargetToRegTranslator()}}),c.textController.innerTextCompiler(),s.translations=function(){if(arguments.length<1)return s;var e=arguments;return c.pluginInterface.registerLanguages(e,c.pluginInterface.initTranslator),s},s.switch=function(e){if("string"!=typeof e||e&&""==e.trim())throw Error("To Translate 'use' function parameter must be a string！");return c.pluginInterface.detectLanguageRegistered(e)?void(e!==s.currentLanguageTag&&c.pluginInterface.switchTranslator(e)):(alert("你要切换的语言{"+e+"}未被注册，请注册后使用！"),void console.log("The language tag ["+e+"] has not been registered!"))},s.nodeString=function(e){return c.pluginInterface.stringSelectTargetToRegTranslator(e)},s.registerElement=function(e,t){return c.nodesController.isolateTranslator(e,t)},s},l=function(t,n){var r={};r[n.namespace]=t,e(a.scopesContainer,r)},s=function(e){return a.scopesContainer[e]?a.scopesContainer[e]:console.log("Can not find a namespace like ["+e+"]!"),null},i={create:function(e){var t=new o(e);return l(t,e),t},use:function(e){return s(e)}};return i});