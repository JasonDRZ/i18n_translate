!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(["Translate"],t):e.Translate=t(e)}("object"==typeof window?window:this,function(e){var t=(e&&e.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},function(e,t){for(var n in t)t.hasOwnProperty(n)&&e&&!e.hasOwnProperty(n)&&(e[n]=t[n])}),n=function(e,t){if(t.length)for(var n=0;n<t.length;e.push(t[n]),n++);};Array.prototype.filter||(Array.prototype.filter=function(e){var t=this.length;if("function"!=typeof e)throw new TypeError;for(var n=new Array,r=arguments[1],a=0;a<t;a++)if(a in this){var o=this[a];e.call(r,o,a,this)&&n.push(o)}return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=this.length,n=0;n<t;e(this[n],n),n++);});var r=Array.prototype.slice,a=Array.prototype.filter;Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this},e.document.querySelectorAll||(e.document.querySelectorAll=function(t){var n,r=e.document.createElement("style"),a=[];for(e.document.documentElement.firstChild.appendChild(r),e.document._qsa=[],r.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),r.parentNode.removeChild(r);e.document._qsa.length;)n=e.document._qsa.shift(),n.style.removeAttribute("x-qsa"),a.push(n);return e.document._qsa=null,a}),e.document.querySelector||(e.document.querySelector=function(t){var n=e.document.querySelectorAll(t);return n.length?n[0]:null});var o={rootScope:e,scopeCamp:{},scopesContainer:{},namespaceCamp:[],namespaceAttributeTag:"translatenamespace"},s=function(l){var c=this;if(!l||l&&!l.default||l&&!l.namespace)throw Error("You must config 'Translate' at least two of Attrs {default: String,namespace: String} in your project.");if(!c instanceof s)return new s(l);var i={namespace:l.namespace,userSetLanguageTag:l.default,elementMatchTagHead:"TransMatch_",elementRegisteredTagHead:"TransRegistered_",translateTextTag:{begin:"@{",end:"}"},translateWrapper:"translateWrapper"},u={allLanguagesData:{},allLanguagesMarks:[],nodeRegisteredList:[]};if(c.Name="Translate",c.Version="1.1.0",c.windowPath=l.windowPath||"window",c.currentLanguage=null,c.namespace=i.namespace,c.defaultNS="default",o.namespaceCamp.join(",").indexOf(c.namespace)!=-1)throw Error("The namespace ["+c.namespace+"] has already been registered by {"+o.scopeCamp[c.namespace].scopePath+"},can not be used again!");n(o.namespaceCamp,[c.namespace]),c.windowPath&&"window"!=c.windowPath?o.scopeCamp[c.namespace]={scopePath:c.windowPath}:console.log("The namespace ["+c.namespace+"] has unknown windowPath! So,this can not be referenced by another namespace!");var g={commonMethod:{},textController:{},nodesController:{},pluginInterface:{}};return t(g.commonMethod,{getAllTargetNodes:function(t,n){return n=n?n:e.document,r.call(n.querySelectorAll(t))},translateMachine:function(e){var t=null===c.currentLanguage?g.commonMethod.setCurrentLangData():c.currentLanguage,n=e.split(".");if(n.clean(""),n.length<1)return"{{Bad Translation!}}";for(var r=0;r<n.length;r++){if(!t[n[r]]){console.log(t),console.log("没跑气的："+n[r]),console.log("["+e+"] 未匹配到目标语言字段，请检查。"),t="{{Bad Translation!}}";break}t=t[n[r]]}return t},switchAttrOrText:function(e,t){var n=e.split("|"),r=g.commonMethod.translateMachine(n[0]);if(n.length>1){var a=n,o=0;for(a.shift();o<a.length;o++)t.setAttribute(a[o],r)}else t.innerHTML=r},getTargetTranslation:function(e,t){e=e.replace(/\s/g,"");var n=e.match(/\{.*?\}/g);n?n.forEach(function(e,n){var r=e.match(/\{(.+\S?)\}/)[1];g.commonMethod.switchAttrOrText(r,t)}):g.commonMethod.switchAttrOrText(e,t)},setCurrentLangData:function(){return c.currentLanguage=u.allLanguagesData[i.userSetLanguageTag]},setCurrentLang:function(e,t){i.userSetLanguageTag=e,"function"==typeof t&&t()}}),t(g.textController,{returnTextTagMatchRegExp:function(e,t){return new RegExp(i.translateTextTag.begin+e+i.translateTextTag.end,t)},stringNodeTranslator:function(e){var t=g.nodesController.getNodeFragment(e);return t},createBLabel:function(t,n){var r=e.document.createElement("b");return r.setAttribute(t,n),r.setAttribute(o.namespaceAttributeTag,t),o.namespaceCamp.join(",").indexOf(t)==-1&&(console.log("Namespace ["+t+"] does not exist!"),r.innerHTML="{{Not supported by any Translation namespace!}}"),r},matchTextTransSource:function(e){return e.replace(g.textController.returnTextTagMatchRegExp(".*?","g"),function(e){var t,n=e.match(g.textController.returnTextTagMatchRegExp("(.+S?)"));if(n=n[1].replace(/\s/g,""),n.indexOf("|")!=-1){var r=n.split("|");t=g.nodesController.getNodeInnerHtmlString(g.textController.createBLabel(r[1],r[0]))}else t=g.nodesController.getNodeInnerHtmlString(g.textController.createBLabel(c.defaultNS,n));return t})},innerTextCompiler:function(e,t){if(e&&""!=e){var n=g.textController.matchTextTransSource(e);return t&&"function"==typeof t&&t(n),n}var r=g.commonMethod.getAllTargetNodes("["+i.translateWrapper+"]");if(console.log(a),r=a.call(r,function(e){return!e[i.translateWrapper]}),!(r.length<1))return r.forEach(function(e,t){var n=g.textController.matchTextTransSource(e.innerHTML);e.innerHTML="",e[i.translateWrapper]=!0,e.appendChild(g.textController.stringNodeTranslator(n))}),t&&t(),null}}),t(g.nodesController,{getNodeFragment:function(t){var n,r,a;return a=e.document.getElementById("frame_range"),null===a&&(a=e.document.createElement("iframe"),a.setAttribute("id","frame_range"),a.setAttribute("style","display: none;"),e.document.body.appendChild(a)),r=e.document.createRange(),r.selectNode(a),n=r.createContextualFragment(t)},getNodeInnerHtmlString:function(t){var n=e.document.createElement("div");return n.appendChild(t),n.innerHTML},selectTargetToRegTranslator:function(e){var t=[];o.namespaceCamp.forEach(function(r){n(t,g.commonMethod.getAllTargetNodes("["+r+"]",e))}),t.length<1||(t=t.filter(function(e){return!e[i.elementRegisteredTagHead+c.namespace]}),console.log(t),t.forEach(function(e,t){var n=e.getAttribute(c.namespace);c.currentLanguage&&n&&(e[i.elementMatchTagHead+c.namespace]=n,e.removeAttribute(c.namespace),g.commonMethod.getTargetTranslation(n,e))}),t=t.filter(function(e){var t=[],n=!0;return o.namespaceCamp.forEach(function(e){e!=c.namespace&&t.push(e)}),t.forEach(function(t){var r=e.getAttribute(t);if(r){var a=o.scopesContainer[t];a.registerElements(e),n=!1}}),n}),g.nodesController.registerNodeList(t))},registerNodeList:function(e){e.forEach(function(e,t){e[i.elementRegisteredTagHead+c.namespace]=!0}),n(u.nodeRegisteredList,e)},isolateTranslator:function(e){var t=e.getAttribute(c.namespace);c.currentLanguage&&t&&(e[i.elementMatchTagHead+c.namespace]=t,console.log(t),e.removeAttribute(c.namespace),g.commonMethod.getTargetTranslation(t,e)),g.nodesController.registerNodeList([e])}}),t(g.pluginInterface,{detectLanguageRegistered:function(e){return u.allLanguagesMarks.join(",").indexOf(e)!=-1},stringSelectTargetToRegTranslator:function(e){var t=g.textController.innerTextCompiler(e),n=g.nodesController.getNodeFragment(t);return g.nodesController.selectTargetToRegTranslator(n),n},registerLanguages:function(e,n){if(1==e.length)if("object"==typeof e[0])t(u.allLanguagesData,e[0]);else try{e=JSON.parse(e[0]),t(u.allLanguagesData,e)}catch(e){console.log(e)}else if(2==e.length){if("string"!=typeof e[0])throw Error("The [translation] parameters should be ([string],[object | JSON string ]) or ([object | JSON string]) !");var r={};if("object"==typeof e[1])r[e[0]]=e[1];else try{r[e[0]]=JSON.parse(e[1])}catch(e){console.log(e)}t(u.allLanguagesData,r)}u.allLanguagesMarks=[];for(var a in u.allLanguagesData)u.allLanguagesMarks.push(a);n&&n()},switchTranslator:function(e){e=e.trim(),g.commonMethod.setCurrentLang(e,g.commonMethod.setCurrentLangData),u.nodeRegisteredList.forEach(function(e,t){var n=u.nodeRegisteredList[t][i.elementMatchTagHead+c.namespace];g.commonMethod.getTargetTranslation(n,e),console.log(e)})},initTranslator:function(){g.commonMethod.setCurrentLangData(),g.nodesController.selectTargetToRegTranslator()},foreignTranslator:function(e){g.nodesController.isolateTranslator(e)}}),g.textController.innerTextCompiler(),c.translation=function(){if(arguments.length<1)return c;var e=arguments;return g.pluginInterface.registerLanguages(e,g.pluginInterface.initTranslator),c},c.switch=function(e){if("string"!=typeof e||e&&""==e.trim())throw Error("To Translate 'use' function parameter must be a string！");return g.pluginInterface.detectLanguageRegistered(e)?void g.pluginInterface.switchTranslator(e):(alert("你要切换的语言{"+e+"}未被注册，请注册后使用！"),void console.log("The language tag ["+e+"] has not been registered!"))},c.nodeString=function(e){return g.pluginInterface.stringSelectTargetToRegTranslator(e)},c.registerElements=function(e){g.pluginInterface.foreignTranslator(e)},c.setRootScope=function(e){},c},l=function(e,n){var r={};r[n.namespace]=e,t(o.scopesContainer,r)},c=function(e){return o.scopesContainer[e]?o.scopesContainer[e]:null},i={create:function(e){var t=new s(e);return l(t,e),t},use:function(e){return c(e)}};return i});