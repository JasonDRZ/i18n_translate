!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(["Translate"],t):e.Translate=t(e)}("object"==typeof window?window:this,function(e){var t=(e&&e.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},function(e,t){for(var n in t)t.hasOwnProperty(n)&&e&&!e.hasOwnProperty(n)&&(e[n]=t[n])}),n=function(e,t){if(t.length)for(var n=0;n<t.length;e.push(t[n]),n++);},r=Array.prototype.slice,a=Array.prototype.filter;Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this};var o={rootScope:e,scopeCamp:{},namespaceCamp:[],namespaceAttributeTag:"translatenamespace"},s=function(l){var i=this;if(!l||l&&!l.default||l&&!l.namespace)throw Error("You must config 'Translate' at least two of Attrs {default: String,namespace: String} in your project.");if(!i instanceof s)return new s(l);var c={namespace:l.namespace,userSetLanguageTag:l.default,elementLanguagePathKey:"languageMatcher",elementRegisteredTagName:"translationRegistered",translateTextTag:{begin:"@{",end:"}"},translateWrapper:"translateWrapper"},g={allLanguagesData:{},allLanguagesMarks:[],nodeRegisteredList:[]};if(i.Name="Translate",i.Version="1.1.0",i.windowPath=l.windowPath||"window",i.currentLanguage=null,i.namespace=c.namespace,i.defaultNS="default",o.namespaceCamp.join(",").indexOf(i.namespace)!=-1)throw Error("The namespace ["+i.namespace+"] has already been registered by {"+o.scopeCamp[i.namespace].scopePath+"},can not be used again!");n(o.namespaceCamp,[i.namespace]),i.windowPath&&"window"!=i.windowPath?o.scopeCamp[i.namespace]={scopePath:i.windowPath}:console.log("The namespace ["+i.namespace+"] has unknown windowPath! So,this can not be referenced by another namespace!");var u=function(e){var t=e.split("."),n=o.rootScope,r=0;do n=n[t[r]],r++;while(r<t.length);return n},f={commonMethod:{},textController:{},nodesController:{},pluginInterface:{}};return t(f.commonMethod,{getAllTargetNodes:function(t,n){return n=n?n:e.document,r.call(n.querySelectorAll(t))},translateMachine:function(e){var t=null===i.currentLanguage?f.commonMethod.setCurrentLangData():i.currentLanguage,n=e.split(".");if(n.clean(""),n.length<1)return"{{Bad Translation!}}";for(var r=0;r<n.length;r++){if(!t[n[r]]){console.log(t),console.log("没跑气的："+n[r]),console.log("["+e+"] 未匹配到目标语言字段，请检查。"),t="{{Bad Translation!}}";break}t=t[n[r]]}return t},switchAttrOrText:function(e,t){var n=e.split("|"),r=f.commonMethod.translateMachine(n[0]);if(n.length>1){var a=n,o=0;for(a.shift();o<a.length;o++)t.setAttribute(a[o],r)}else t.innerHTML=r},getTargetTranslation:function(e,t){e=e.replace(/\s/g,"");var n=e.match(/\{.*?\}/g);n?n.forEach(function(e,n){var r=e.match(/\{(.+\S?)\}/)[1];f.commonMethod.switchAttrOrText(r,t)}):f.commonMethod.switchAttrOrText(e,t)},setCurrentLangData:function(){return i.currentLanguage=g.allLanguagesData[c.userSetLanguageTag]},setCurrentLang:function(e,t){c.userSetLanguageTag=e,"function"==typeof t&&t()}}),t(f.textController,{returnTextTagMatchRegExp:function(e,t){return new RegExp(c.translateTextTag.begin+e+c.translateTextTag.end,t)},stringNodeTranslator:function(e){var t=f.nodesController.getNodeFragment(e);return t},createBLabel:function(t,n){var r=e.document.createElement("b");return r.setAttribute(t,n),r.setAttribute(o.namespaceAttributeTag,t),o.namespaceCamp.join(",").indexOf(t)==-1&&(console.log("Namespace ["+t+"] does not exist!"),r.innerHTML="{{Not supported by any Translation namespace!}}"),r},matchTextTransSource:function(e){return e.replace(f.textController.returnTextTagMatchRegExp(".*?","g"),function(e){var t,n=e.match(f.textController.returnTextTagMatchRegExp("(.+S?)"));if(n=n[1].replace(/\s/g,""),n.indexOf("|")!=-1){var r=n.split("|");t=f.nodesController.getNodeInnerHtmlString(f.textController.createBLabel(r[1],r[0]))}else t=f.nodesController.getNodeInnerHtmlString(f.textController.createBLabel(i.defaultNS,n));return t})},innerTextCompiler:function(e,t){if(e&&""!=e){var n=f.textController.matchTextTransSource(e);return t&&"function"==typeof t&&t(n),n}var r=f.commonMethod.getAllTargetNodes("["+c.translateWrapper+"]");if(r=a.call(r,function(e){return!e[c.translateWrapper]}),!(r.length<1))return r.forEach(function(e,t){var n=f.textController.matchTextTransSource(e.innerHTML);e.innerHTML="",e[c.translateWrapper]=!0,e.appendChild(f.textController.stringNodeTranslator(n))}),t&&t(),null}}),t(f.nodesController,{getNodeFragment:function(t){var n,r,a;return a=e.document.getElementById("frame_range"),null===a&&(a=e.document.createElement("iframe"),a.setAttribute("id","frame_range"),a.setAttribute("style","display: none;"),e.document.body.appendChild(a)),r=e.document.createRange(),r.selectNode(a),n=r.createContextualFragment(t)},getNodeInnerHtmlString:function(t){var n=e.document.createElement("div");return n.appendChild(t),n.innerHTML},selectTargetToRegTranslator:function(e){var t=[];o.namespaceCamp.forEach(function(r){n(t,f.commonMethod.getAllTargetNodes("["+r+"]",e))}),t.length<1||(t=t.filter(function(e){return!e[c.elementRegisteredTagName]}),console.log(t),t.forEach(function(e,t){var n=e.getAttribute(i.namespace);i.currentLanguage&&n&&(e[c.elementLanguagePathKey]=n,e.removeAttribute(i.namespace),f.commonMethod.getTargetTranslation(n,e))}),t=t.filter(function(e){var t=[],n=!0;return o.namespaceCamp.forEach(function(e){e!=i.namespace&&t.push(e)}),t.forEach(function(t){var r=e.getAttribute(t);if(r){var a=u(o.scopeCamp[t].scopePath);a.registerElements(e),n=!1}}),n}),f.nodesController.registerNodeList(t))},registerNodeList:function(e){e.forEach(function(e,t){e[c.elementRegisteredTagName]=!0}),n(g.nodeRegisteredList,e)},isolateTranslator:function(e){var t=e.getAttribute(i.namespace);i.currentLanguage&&t&&(e[c.elementLanguagePathKey]=t,console.log(t),e.removeAttribute(i.namespace),f.commonMethod.getTargetTranslation(t,e)),f.nodesController.registerNodeList([e])}}),t(f.pluginInterface,{detectLanguageRegistered:function(e){return g.allLanguagesMarks.join(",").indexOf(e)!=-1},stringSelectTargetToRegTranslator:function(e){var t=f.textController.innerTextCompiler(e),n=f.nodesController.getNodeFragment(t);return f.nodesController.selectTargetToRegTranslator(n),n},registerLanguages:function(e,n){if(1==e.length)if("object"==typeof e[0])t(g.allLanguagesData,e[0]);else try{e=JSON.parse(e[0]),t(g.allLanguagesData,e)}catch(e){console.log(e)}else if(2==e.length){if("string"!=typeof e[0])throw Error("The [translation] parameters should be ([string],[object | JSON string ]) or ([object | JSON string]) !");var r={};if("object"==typeof e[1])r[e[0]]=e[1];else try{r[e[0]]=JSON.parse(e[1])}catch(e){console.log(e)}t(g.allLanguagesData,r)}g.allLanguagesMarks=[];for(var a in g.allLanguagesData)g.allLanguagesMarks.push(a);n&&n()},switchTranslator:function(e){e=e.trim(),f.commonMethod.setCurrentLang(e,f.commonMethod.setCurrentLangData),g.nodeRegisteredList.forEach(function(e,t){var n=g.nodeRegisteredList[t][c.elementLanguagePathKey];f.commonMethod.getTargetTranslation(n,e),console.log(e)})},initTranslator:function(){f.commonMethod.setCurrentLangData(),f.nodesController.selectTargetToRegTranslator()},foreignTranslator:function(e){f.nodesController.isolateTranslator(e)},resetRootScope:function(e){}}),i.translation=function(){if(arguments.length<1)return i;var e=arguments;return f.pluginInterface.registerLanguages(e,f.pluginInterface.initTranslator),i},i.use=function(e){if("string"!=typeof e||e&&""==e.trim())throw Error("To Translate 'use' function parameter must be a string！");return f.pluginInterface.detectLanguageRegistered(e)?void f.pluginInterface.switchTranslator(e):(alert("你要切换的语言{"+e+"}未被注册，请注册后使用！"),void console.log("The language tag ["+e+"] has not been registered!"))},i.nodeString=function(e){return f.pluginInterface.stringSelectTargetToRegTranslator(e)},i.registerElements=function(e){f.pluginInterface.foreignTranslator(e)},i.setRootScope=function(e){}(function(){f.textController.innerTextCompiler()})(),i};return s});